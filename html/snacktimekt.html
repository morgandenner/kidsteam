<?php
require_once 'php/secsession.php';
require_once 'php/logincheck.php';
session_start();
?>
<!-- Copyright Morgan Denner
02.2015 made for Greg Walsh 
This is the online version of Kids Team group
in conjunction with independent study
Contact morgan at morgan.denner@ubalt.edu -->
<!--================LANDING PAGE===========================-->
<!DOCTYPE html>
<html lang="en">
<head>
<!--=========GOOGLE FONTS================================ -->
    <link href="http://fonts.googleapis.com/css?family=Pacifico" rel='stylesheet' type='text/css'>
    <link href="http://fonts.googleapis.com/css?family=Lora" rel='stylesheet' type='text/css'>

    <title>KIDS TEAM LANDING</title>

<!--=============VIEWPORT TAGS===============================-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!--===============CSS==========================-->
    <link rel="stylesheet" type="text/css" href="css/style.css" />

	<link rel="stylesheet" type="text/css" href="css/moonMap.css" />

<!--==============Bootstrap=========================-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

</head>
	
<!-- the onload function below will update the chat window every 1 second -->
<body>

    <div class="wrap">

<!--====================TOP MENU=============================-->
       <header class="main-header">

<!--======================BOOTSTRAP NAV BAR==================-->
<!--==================http://getbootstrap.com/components/===-->
            <nav class="navbar navbar-default">
                <div class="container-fluid">

                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>  
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>  
                        </button>
                        <a class="navbar-brand" href="#"><img src="img/logo.png" /></a>
                        
                    </div>

                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <ul class="nav navbar-nav navbar-right">
<!--=====THIS SECTION IS HIDDEN IF THE USER IS LOGGED OUT==-->
                          <div id="in">
                            <li><a href="#">Snack Time</a></li>
                            <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Discussion <span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="#">This Week</a></li>
                                <li class="divider"></li>
                                <li><a href="#">Previous Weeks</a></li>
                            </ul></li>
                            <li><a href="#">Design</a></li>
                            <li><a href="#">Gallery</a></li>
                            <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Account <span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="#">My Profile</a></li>
                                
                                <li class="divider"></li>
                                <li><a href="#">Sign Out</a>   </li></ul></li>
                            </div><!--end of #in -->
 <!--=====THIS SECTION IS HIDDEN IF THE USER IS LOGGED IN==-->
                            <li id ="out" class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Account <span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="loginkt.php">Login</a></li>
                                <li class="divider"></li>

                                <li><a href="#">Join</a></li></ul></li>
<!--=====THIS SECTION IS HIDDEN IF THE USER IS LOGGED OUT==-->

<!--=======================================================-->
                        </ul><!--END OF RIGHT COLLAPSING NAV-->
                    </div><!-- /.navbar-collapse -->
                </div><!-- /.container-fluid -->
            </nav>
        </header><!--end of header --> 

        <div class="row">

<!--===================== CONTENT=======================-->
            <div class="col-xs-12 col-md-12" id="content-right">	
				<!--start of chat online status -->
				<div id="center" class="orbit-center">
  				<span>Snack Time</span>
				</div>
				<span class="moonSelector">frankenstein</span>
				<span class="moonSelector">test</span>
				<span class="moonSelector">test</span>
				<span class="moonSelector">test</span>
				<span class="moonSelector">test</span>
				<span class="moonSelector">test</span>
				<span class="moonSelector">test</span>
				
                <div class="col-xs-12 col-sm-12" id="chatwindow">
				<div class="row" id="chatappend">

				</div><!--end of row-->
						
					
				</div><!--end of chatwindow-->
				<div class="col-xs-12 col-sm-12" id="table" >
      
				</div><!--end of table-->
<div class="col-xs-12 col-sm-12" id="chat">
					<form name='myForm' data-ajax='true'>

        					<textarea type='text' id='textarea' class='form-group' cols="10" rows="1" maxlength='150'></textarea>
						<div id="text-count"></div>
					</form>
					<button class="btn btn-default" type='button' onclick='chat()'>Send</button>
</div>
			
				
            </div><!-- end of #content-right-->


        </div><!-- end of .row -->   
<div id="response"></div>
    </div><!--end of wrap div-->

<!--=====================FOOTER======================-->
    <footer class="site-footer footer">
        <div class="row">
            <div class="col-sm-4 col-xs-4">&copy; Copyright 2015</div>
            <div class="col-sm-4 col-xs-4"><a href="#">| About Kids Team |</a></div>
            <div class="col-sm-4 col-xs-4"><a href="#">| Contact Kids Team |</a></div>
        </div><!-- end of .row-->
    </footer>



<!--===========JQUERY AND JAVASCRIPT==================-->

<!-- jquery v1.11.2 cdn www.jquery.com -->    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

<!-- javascript source file -->
<script type="text/javascript" src="js/script.js"></script>

<!-- bootstrap v3.3.2 cdn www.getboostrap.com -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

    <!-- script to hide either the login or logout buttons based on if the user is logged in or out -->
<script type="text/javascript">

    $.ajax({
      url: 'php/logincheck.php',
      type: 'get',
      success: function(data) {
        if(data == "out") {
            $('#in').hide();
        }else{
           $('#out').hide(); 
        }
      },
      error: function(xhr, desc, err) {
        console.log(xhr);
        console.log("Details: " + desc + "\nError:" + err);
      }
    }); // end ajax call
	
</script>
<!-- http://www.thecave.info/pass-a-php-array-to-javascript-as-json-using-ajax-and-json_encode/ -->
<!-- ajax call to show who is online in the space provided -->
<script type="text/javascript">
    $.ajax({
        url: 'php/whoisonline.php',
        type: 'get',
        dataType: 'json',
        success: function(data) {
            for (var i=0; i < data.length; i++){
            $('#php').append('<div id="student"></br>' 
                             + '<div id="circle"></div>'
                             + '<div id="name">' + data[i].name + '</div></br>'
                             + '</div>');
            }
        },
        error: function(xhr, desc, err) {
            console.log(xhr);
            console.log("Details: " + desc + "\nError:" + err);
        }
        }); // end ajax call
</script>
	
<!--function to load the chat table where the date matches today on page load.  Everytime a user visits the page this is the first script that runs, will pull all rows from the chat log that match today's date-->
<script type="text/javascript">
	$(document).ready(updateChat());
	function updateChat(){
		$.ajax({
			type: 'get',
			url: 'php/loadchat.php',
			dataType: 'json',
			success: function(data){
				for (var i=0; i < data.length; i++){
            		$('#chatappend').append(
						'<div id="chatline">' + 
						'<div class="col-xs-3 col-sm-3" id="icon">' + 
						'<div id="student">' + 
							'<div id="chatcircle"></div>' + 
							'<div id="chatname">' + data[i].name + '</div>' + 
							'<div id="date">' + data[i]. date + '</div>' + 
						'</div><!--end of student-->' + 
					'</div><!--end of col-3-->' + 
					'<div class="col-xs-9 col-sm-9" id="chatbubble">' + 
						'<p>' + data[i].message + '</p>' + 
					'</div><!--end of col-8-->' + 
					'</div><!--end of chatline-->'
					);
            	}
        	},
			error: function(xhr, desc, err) {
            console.log(xhr);
            console.log("Details: " + desc + "\nError:" + err);
        }
		});
	}
</script>
		
<script type="text/javascript">
	//function for sending the chat message into the window
	function chat(){
	sendChat();
	retrievechat();
	}
	
	function sendChat(){
var ajaxRequest;

try{
// Opera 8.0+, Firefox, Safari
ajaxRequest = new XMLHttpRequest();
} catch (e){
// Internet Explorer Browsers
try{
	ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
} catch (e) {
	try{
		ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
	} catch (e){
		// Something went wrong
		alert("Your browser broke!");
		return false;
	}
}
}
// Create a function that will receive data sent from the server
ajaxRequest.onreadystatechange = function(){
//if the server is ready to respond, send the echo into the div
if(ajaxRequest.readyState == 4){

}
}

var message = document.getElementById('textarea').value;
//sends the chat message to PHP
var queryString = "?message=" + message;
ajaxRequest.open("GET", "php/sendchat2.php" + queryString, true);
ajaxRequest.send(null); 	
	}	
	
function retrievechat(){
		$.ajax({
			type: 'get',
			url: 'php/retrievechat.php',
			dataType: 'json',
			success: function(log){
            		$('#chatappend').append(
						'<div id="chatline">' + 
						'<div class="col-xs-3 col-sm-3" id="icon">' + 
						'<div id="student">' + 
							'<div id="chatcircle"></div>' + 
							'<div id="chatname">' + log[0].name + '</div>' + 
							'<div id="date">' + log[0].date + '</div>' + 
						'</div><!--end of student-->' + 
					'</div><!--end of col-3-->' + 
					'<div class="col-xs-9 col-sm-9" id="chatbubble">' + 
						'<p>' + log[0].message + '</p>' + 
					'</div><!--end of col-8-->' + 
					'</div><!--end of chatline-->'
					);
        	},
			error: function(xhr, desc, err) {
            console.log(xhr);
            console.log("Details: " + desc + "\nError:" + err);
        }
		});
	}
</script>

<!--==========Moon Map link to moonmap.js file.  Credits go to www.moonmapjs.com =========================================-->
<script src="js/moonMap.min.js" type="text/javascript"></script>
<script type="text/javascript">
	var map = new MoonMap('#center', {
		moonSelector: '.moonSelector',
		radius: 125
		
	});
</script>

<!--===============chat message character count courtesy of http://jsfiddle.net/timur/47a7A/===========================-->
<script type="text/javascript">
	$(document).ready(function() {
    var text_max = 150;
    $('#text-count').html(text_max + ' characters remaining');

    $('#textarea').keyup(function() {
        var text_length = $('#textarea').val().length;
        var text_remaining = text_max - text_length;

        $('#text-count').html(text_remaining + ' characters remaining');
    });
});
</script>
</body>

</html>
